---
title: 工作笔记
link: working-note
start: 2021-01-25
date: 
updated: 
categories: 笔记
tags: [iOS, Android]
---

## 目前环境与框架

硬件: MacBook Pro 2017
OS: macOS Mojave
Android: Android Studio3.2, Java8, MVP, Retrofit
iOS: Xcode11, Swift5, Storyboard, Alamofire

## iOS 捕捉 UIImagePickerController 下拉返回事件

问题：

UIImagePickerControllerDelegate 中只有选择图片和点击取消事件，而没有下拉返回事件。而进入 UIImagePickerController 前我会使原界面进入 loading 状态，于是下拉返回后依然在 loading 状态。

解决：

> [参考](https://stackoverflow.com/questions/60809825/detect-if-imagepickercontroller-is-closed-with-swipe-down-gesture-with-objective)

注：Swift 没有匿名内部类

```swift
class X: UIAdaptivePresentationControllerDelegate {

    func presentPicker() {
        let picker = UIImagePickerController()
        picker.presentationController?.delegate = self
    }

    func presentationControllerDidDismiss(_ presentationController: UIPresentationController) {
        //TODO: 取消 loading
    }

}
```

## iOS 模拟器模拟两点点击

按住⌥：显示两点，位置以模拟器中心点中心对称
按住⇧⌥：固定两点相对位置

似乎不能模拟三点或更多点

## iOS 防止同时 push 多个 VC

> [参考](https://blog.csdn.net/qq_32117417/article/details/82868459)

```swift
class BaseNC: UINavigationController, UINavigationControllerDelegate {

    var pushing = false

    override func viewDidLoad() {
        super.viewDidLoad()
        interactivePopGestureRecognizer?.delegate = nil
        self.delegate = self
    }

    // MARK: UINavigationControllerDelegate
    func navigationController(_ navigationController: UINavigationController, didShow viewController: UIViewController, animated: Bool) {
        self.pushing = false
    }

    override func pushViewController(_ viewController: UIViewController, animated: Bool) {
        if self.pushing {
            //拦截
            return
        } else {
            self.pushing = true
            super.pushViewController(viewController, animated: true)
        }
    }

}
```

单纯地在 push 动画过程中拦截掉其他 push，如果确实需要快速 push 多个 VC 可能会误拦截。
我想了一下我好像没有快速 push 多个 VC 的情况所以就用上了，结果上线之后还真有某个跳转到第三方页面的页面误拦截了，所以不推荐使用。

这个问题扩展开来是重复点击的问题，Rx 的 `throttleFirst` 操作符是解决方案之一。

## XCode 上传包失败问题

Mac 的邮件 App 里连接 Gmail 需要在系统设置里开启 SOCKS 代理，参考 [知乎](https://www.zhihu.com/question/27289501/answer/498254559)。
不过 XCode 上传包也用的 SOCKS 协议，而且代理后会上传失败，所以需要暂时关闭 SOCKS 代理。
当然包上传失败还有很多原因。

## Android debug 包正常，release 包闪退 bug

神奇的问题，记录下解决过程。

一开始尝试打印日志（正式包打印日志需要设置 `app.gradle` 中 `buildTypes.release` 的 `buildConfigField "Boolean", "LOGGING", "false"）` 与 `debuggable true`），看到的是 NPE。

因为闪退处包含解析 assets 中的 json 的步骤，以为是正式包没有成功解析文件，但捕捉了所有 null 后还是闪退。

再次对比 debug 和 release 的区别：

```java
buildTypes {
    release {
        signingConfig signingConfigs.release
        buildConfigField "Boolean", "LOGGING", "false"
        debuggable false
        minifyEnabled true
        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }

    debug {
        signingConfig signingConfigs.release
        buildConfigField "Boolean", "LOGGING", "true"
        debuggable true
        minifyEnabled false
    }
}
```

签名是一样的（因为很多第三方 SDK 不能设置调试用签名），日志应该没有影响，只剩下 debuggable 和 minifyEnabled（代码混淆）。

尝试给 debug 包增加混淆设置后成功复现，总算确定问题点，但还是没搞懂跟混淆有什么关系。

最后是发现一个 Bean 类的 package 写错了（因为是复制的网络代码），这个写错了居然也能编译通过的吗，而且不混淆就不报错，就离谱。
