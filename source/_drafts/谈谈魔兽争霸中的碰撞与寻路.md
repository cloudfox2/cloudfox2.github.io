---
title: 谈谈魔兽争霸中的碰撞与寻路
link: collision-size-in-warcraft
start: 2021-02-24
date: 
updated: 
categories: 游戏
tags: 魔兽地图编辑器
---

## 前言

《魔兽争霸 3》中单位的碰撞体积分两种，姑且名为「攻击碰撞」与「寻路碰撞」，这两者都由「碰撞体积」这一参数决定，但两者区别很大。

<!-- more -->

## 攻击碰撞

所有单位的攻击碰撞是个圆形（半径为碰撞体积的值），计算攻击距离、范围技能效果时，都使用这个碰撞。
碰撞体积是多少攻击碰撞就是多少，超过 1024 都可以。

在 FPS 与 FTG 中，这个概念也叫做命中框（hitbox），是其玩法的一个核心概念。

## 寻路碰撞

地面单位的寻路碰撞是个正方形，也因此魔兽只有十字围杀而没有 X 字围杀，该碰撞只在寻路时使用。
地面单位的寻路碰撞一共只有 4 种，相当于 16 / 32 / 48 / 64，对应边长为 32 / 64 / 96 / 128 的正方形。
碰撞体积为 0~15.99 时，寻路碰撞为 16。比如所有被网下来的空军。
碰撞体积为 16~31.99 时，寻路碰撞为 32。比如农民的碰撞体积是 16，步兵是 31，他们的寻路碰撞都是 32。
碰撞体积为 32~47.99 时，寻路碰撞为 48。比如火枪手、蜘蛛和所有英雄。
碰撞体积为 48 以上时，寻路碰撞为 64。比如坦克和山岭。

在以前一些介绍碰撞体积的文章中，32 / 48 / 64 这三种寻路碰撞的单位也被称为小/中/大型单位。

TODO

另外很坑爹的一点是，寻路碰撞为 32 和 64 的单位的攻击碰撞中心与寻路碰撞中心不一致，偏移了（16，16）的距离，也是 18 年我做移动幻影时才发现的事。

## 移动类型

### 飞行

移动类型为「飞行」和「没有」的单位寻路碰撞都是 0（或者说没有寻路碰撞），寻路时也不会被地面的障碍所阻挡，除非被网下来（但空军移动时依然需要进行寻路，因为还有空中障碍物的存在，虽然这种障碍物在对战地图中很少见）。

### 建筑物

建筑物的「寻路碰撞」则由「路径纹理」决定，「攻击碰撞」由「碰撞体积」和「路径纹理」共同决定，取其并集（但计算范围技能效果时，又只计算建筑的碰撞体积了）。

## 碰撞类型

## 组群分离

空军会自动散开是因为「组群分离」的设置，把「组群分离」关了空军就不会散开了，暴雪本身只在所有空军上设置了「组群分离」，其实将「组群分离」设置在地面单位上也可以看到同样的效果。

## 地图边界

## 结语

其实在编辑器里摆放单位的时候寻路碰撞就与攻击碰撞完全一致，也是圆形，且和碰撞体积的值完全相同。
因此可以推断在暴雪的设计中攻击碰撞与寻路碰撞应该是一致的，但由于技术问题，寻路碰撞变为了四种正方形。

这主要是因为寻路算法的优化问题，寻路算法本身就比较复杂，并且 RTS 中单位数量多、地形复杂，不进行优化 CPU 负担不起，魔兽中为了不让寻路占用过多资源，还对寻路上限进行了限制，每个玩家 50 个单位同时移动基本流畅，到 64 个单位开始卡顿，80 个开始较为严重。主要是魔兽发售于 02 年，其实以现在的计算机性能，每个玩家 100 个单位的寻路不成问题。
总之，所有移动物体和障碍都由 16×16 的正方形组成，更有利寻路算法的优化，也阴差阳错地催生了经典的十字围杀。

随着电脑性能和暴雪程序员技术的提升，到了星际 2，寻路碰撞就变为顺滑的圆形了。
